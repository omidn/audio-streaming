<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/web-speech.js | sound-api</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-recorder">recorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-webspeech">webspeech</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RecordType">RecordType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-WebKitType">WebKitType</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/web-speech.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import lowerCase from &apos;lodash/lowerCase&apos;;
import noop from &apos;lodash/noop&apos;;
import extend from &apos;lodash/extend&apos;;
/** 
* @desc defaults
*/
const defaults = {
  interimResults: false,
  continuous: true,
  lang: &apos;en-US&apos;,
  maxAlternatives: 3,
  onResult: noop,
};

/** 
* @desc returns the recorder instance from webKitAudioContext
* @example 
* import api from &apos;sound-api&apos;;
* const recorder = api.webSpeechApi({
*   commands: {
*    &apos;go-up&apos;: () =&gt; {
*      window.scrollBy(0, -500);
*    },
*    &apos;go-down&apos;: () =&gt; {
*      window.scrollBy(0, 500);
*    },
*  },
* });
* @param {WebKitType} [options] options options
* @return {object} 
* @property {function} start - starts recording audio from microphone
* @property {function} stop  - stops recording audio from microphone
*/
export default function (options) {
  const opt = extend(defaults, opt);
  const recognition = new webkitSpeechRecognition();
  
  if (opt.commands) {
    const commands = options.commands;
    const grammar = `#JSGF V1.0; grammar commands; public &lt;command&gt; = ${Object.keys(commands).map(x =&gt; lowerCase(x)).join(&apos; | &apos;)} ;`;
    const list = new webkitSpeechGrammarList();
    list.addFromString(grammar, 1);
    recognition.grammars = list;
  }

  recognition.continuous = opt.continuous;
  recognition.interimResults = opt.interimResults;
  recognition.lang = opt.lang
  recognition.maxAlternatives = opt.maxAlternatives;

  const start = () =&gt; {
    recognition.start();
    console.log(&apos;started recording&apos;);
  }
  
  const stop = () =&gt; {
    recognition.stop();
    console.log(&apos;stopped recording&apos;);
  }

  recognition.onresult = function(e) {
    const msg = e.results[e.results.length - 1];
    
    if (options.onResult) {
      opt.onResult(msg);
    }
  }
  
  recognition.onerror = function(event) {
    console.log(event.error);
  }
  
  return {
    start,
    stop,
  }
}

/** 
* @typedef {Object} WebKitType
* @property {function} onResult - callback to receive Audio-to-Text results
* @property {string} [lang] - set preferred language language 
* @property {string} [interimResults] - receive intermediate results
* @property {boolean} [continuous] - record audio continuous
* @property {number} [maxAlternatives] - maximum number of alternatives
*/
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
